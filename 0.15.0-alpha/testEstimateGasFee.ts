import {
  AxelarQueryAPI,
  AxelarQueryAPIFeeResponse,
  Environment,
} from "@axelar-network/axelarjs-sdk";
import { BigNumber, ethers } from "ethers";

console.warn = () => {};

const GAS_MULTIPLIER = 1;

function getGasLimit(destChain: string) {
  switch (destChain) {
    case "mantle":
      return 703_182_912; // https://explorer.mantle.xyz/tx/0xd4f6627648dd7d4ab23537ae9020915c5ee870c8260938f13d9685b46a16a237
    case "optimism":
      return 118_406; // https://optimistic.etherscan.io/tx/0xa690c312d7535718a3ed5890855be32f1c6776c6f12dfa16485e058fbe1af5e2
    case "blast":
      return 211_356; // https://blastscan.io/tx/0xd15a62a0231f3907cf9406b61f1ca134e931d9b7244813fca476e5664cfb42df
    case "fraxtal":
      return 111_840; // https://fraxscan.com/tx/0xc8dbb8fecc8355422be4c6706e1a280cf8e98f1e1044d554ee4abac2e60f1668
    case "scroll":
      return 128_415; // https://scrollscan.com/tx/0x622e1de9ce9f8617717430dc08e3202a39cfeb3a45cde4870b9b53632dacf9c8
    case "base":
      return 112_298; // https://basescan.org/tx/0xad7f09d9fc648eef78fa08107b576e948ccf1f78d6149aff1b8273e535f1fbe8
    case "arbitrum":
      return 382_910; // https://arbiscan.io/tx/0x8b173ad2743f71fe11c4f8286f082eaca4e87f0a0c1ab5475ddfeea06a76a5b6
    default:
      return 200_000;
  }
}

function getExecuteData(destChain: string) {
  switch (destChain) {
    case "mantle":
      // based on execute data here https://explorer.mantle.xyz/tx/0xd4f6627648dd7d4ab23537ae9020915c5ee870c8260938f13d9685b46a16a237
      return "0x414bf38900000000000000000000000078c1b0c915c4faa5fffa6cabf0219da63d7f4cb8000000000000000000000000201eba5cc46d216ce6dc03f6a759e8e766e956ae00000000000000000000000000000000000000000000000000000000000001f40000000000000000000000001eec842bcd7cb0253e89cb8a1b65aac31952eb240000000000000000000000000000000000000000000000000000000065f81a75000000000000000000000000000000000000000000000000061b31ab352c000000000000000000000000000000000000000000000000000000000000000589c800000000000000000000000000000000001388ffbccf85873aaf33e161ceabcc";
    case "optimism":
      // based on execute data here https://optimistic.etherscan.io/tx/0xa690c312d7535718a3ed5890855be32f1c6776c6f12dfa16485e058fbe1af5e2
      return "0x1a98b2e02c5572c7b09abc5223350776a4442de92517be119b56658fc65f9a101e33544400000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000011600000000000000000000000000000000000000000000000000000000001e1c448000000000000000000000000000000000000000000000000000000000000000762696e616e636500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a307863653136463639333735353230616230313337376365374238386635424138433438463844363636000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fe000000000000000000000000000000000000000000000000000000000000000400000000000000000000000004283dbf4482c534248bc14a370e54d73e0a16d7a00000000000000000000000000000000000000000000000000000000000000090000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000003a000000000000000000000000000000000000000000000000000000000000005c0000000000000000000000000000000000000000000000000000000000000074000000000000000000000000000000000000000000000000000000000000009600000000000000000000000000000000000000000000000000000000000000ae00000000000000000000000000000000000000000000000000000000000000d000000000000000000000000000000000000000000000000000000000000000e6000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f4052150000000000000000000000000000000000000000000000000000000000000001000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f405215000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000044095ea7b300000000000000000000000068b3465833fb72a70ecdf485e0e4c7bd8665fc450000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f4052150000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000068b3465833fb72a70ecdf485e0e4c7bd8665fc45000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000000e404e45aaf000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f4052150000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c316070000000000000000000000000000000000000000000000000000000000000064000000000000000000000000ea749fd6ba492dbc14c24fe8a3d08769229b896c0000000000000000000000000000000000000000000000000000000001e1d34c0000000000000000000000000000000000000000000000000000000001e162b80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f405215000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000010000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c31607000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000044095ea7b300000000000000000000000068b3465833fb72a70ecdf485e0e4c7bd8665fc4500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c316070000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000068b3465833fb72a70ecdf485e0e4c7bd8665fc45000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000000e404e45aaf0000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c316070000000000000000000000001f32b1c2345538c0c6f582fcb022739c4a194ebb00000000000000000000000000000000000000000000000000000000000001f4000000000000000000000000ea749fd6ba492dbc14c24fe8a3d08769229b896c0000000000000000000000000000000000000000000000000000000001e17b5f000000000000000000000000000000000000000000000000001a2770c22a10c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000007f5c764cbc14f9669b88837ca1490cca17c31607000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000010000000000000000000000001f32b1c2345538c0c6f582fcb022739c4a194ebb000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000044095ea7b300000000000000000000000068b3465833fb72a70ecdf485e0e4c7bd8665fc4500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000001f32b1c2345538c0c6f582fcb022739c4a194ebb0000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000068b3465833fb72a70ecdf485e0e4c7bd8665fc45000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000000e404e45aaf0000000000000000000000001f32b1c2345538c0c6f582fcb022739c4a194ebb00000000000000000000000042000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000064000000000000000000000000ea749fd6ba492dbc14c24fe8a3d08769229b896c000000000000000000000000000000000000000000000000001a30d3c4be6704000000000000000000000000000000000000000000000000001e4d61d5ba6c1b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000001f32b1c2345538c0c6f582fcb022739c4a194ebb000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000010000000000000000000000004200000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000242e1a7d4d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000004200000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000004283dbf4482c534248bc14a370e54d73e0a16d7a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000761786c5553444300000000000000000000000000000000000000000000000000";
    case "blast":
      // based on execute data here https://blastscan.io/tx/0xd15a62a0231f3907cf9406b61f1ca134e931d9b7244813fca476e5664cfb42df
      return "0x1a98b2e0b76bbae7a8aab43aa3e15e827b48666769ec35d1cd09ce7773ba541dde3020c700000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000d80000000000000000000000000000000000000000000000000000000000048cc5e0000000000000000000000000000000000000000000000000000000000000007506f6c79676f6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a307863653136463639333735353230616230313337376365374238386635424138433438463844363636000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000ca36e3837f915d0308e89a584c70038666bea6a1000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000005a0000000000000000000000000000000000000000000000000000000000000072000000000000000000000000000000000000000000000000000000000000009600000000000000000000000000000000000000000000000000000000000000ac000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f4052150000000000000000000000000000000000000000000000000000000000000001000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f405215000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000044095ea7b300000000000000000000000054cf3d259a06601b5bc45f61a16443ed5404dd640000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f4052150000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000054cf3d259a06601b5bc45f61a16443ed5404dd64000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000010438ed1739000000000000000000000000000000000000000000000000000000000048ca5d00000000000000000000000000000000000000000000000042d888171b80514000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000ea749fd6ba492dbc14c24fe8a3d08769229b896c0000000000000000000000000000000000000000000000000000018e59dbe2bf0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f4052150000000000000000000000004300000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f405215000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000004300000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000337827814155ecbf24d20231fca4444f530c05550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000430000000000000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000337827814155ecbf24d20231fca4444f530c0555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000104414bf3890000000000000000000000004300000000000000000000000000000000000003000000000000000000000000430000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000001f4000000000000000000000000ea749fd6ba492dbc14c24fe8a3d08769229b896c0000000000000000000000000000000000000000000000000000018e59dbe2c000000000000000000000000000000000000000000000000043bb4f3e652b84d30000000000000000000000000000000000000000000000000005443f430d356a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000004300000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000010000000000000000000000004300000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000242e1a7d4d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000430000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000000000000000000000ca36e3837f915d0308e89a584c70038666bea6a1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000761786c5553444300000000000000000000000000000000000000000000000000";
    case "fraxtal":
      // based on execute data here https://fraxscan.com/tx/0xc8dbb8fecc8355422be4c6706e1a280cf8e98f1e1044d554ee4abac2e60f1668
      return "0x1a98b2e06403807eb42e9bb767cf5a24349203b83c0e0ab59003ae0ba48302a90ec14ae600000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000d8000000000000000000000000000000000000000000000000000000000d726ebc30000000000000000000000000000000000000000000000000000000000000008617262697472756d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a307863653136463639333735353230616230313337376365374238386635424138433438463844363636000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000400000000000000000000000001c3b3fb3295f8ba458da832dd113e6628c273ac9000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000005a0000000000000000000000000000000000000000000000000000000000000072000000000000000000000000000000000000000000000000000000000000009600000000000000000000000000000000000000000000000000000000000000ac000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f4052150000000000000000000000000000000000000000000000000000000000000001000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f405215000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000aaae99091fbb28d400029052821653c1c752483b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f40521500000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000aaae99091fbb28d400029052821653c1c752483b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000104414bf389000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f405215000000000000000000000000fc000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000064000000000000000000000000ddcb003eaee0d778d0b56e20d1943b957bc1ab0f0000000000000000000000000000000000000000000000000000018e59eb350300000000000000000000000000000000000000000000000000000000d74149230000000000000000000000000000000000000000000000c15461a4a31422bc700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f40521500000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000001000000000000000000000000fc00000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000044095ea7b3000000000000000000000000aaae99091fbb28d400029052821653c1c752483b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000fc0000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001000000000000000000000000aaae99091fbb28d400029052821653c1c752483b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000104414bf389000000000000000000000000fc00000000000000000000000000000000000001000000000000000000000000fc0000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000fa000000000000000000000000ddcb003eaee0d778d0b56e20d1943b957bc1ab0f0000000000000000000000000000000000000000000000000000018e59eb35030000000000000000000000000000000000000000000000c3e39fd695455d48730000000000000000000000000000000000000000000000000f48d4e982cd3f930000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000fc0000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000001000000000000000000000000fc00000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000242e1a7d4d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000fc00000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000001c3b3fb3295f8ba458da832dd113e6628c273ac9000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000761786c5553444300000000000000000000000000000000000000000000000000";
    case "base":
      // based on execute data here https://basescan.org/tx/0xad7f09d9fc648eef78fa08107b576e948ccf1f78d6149aff1b8273e535f1fbe8
      return "0x49160658efc8af2e7ad5ac2242d74163080d597f984db59f3e1c5c82ce4d741017c70b58000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000000762696e616e636500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a30784235464234424530323233324231624241346443386638316463323443323639383064453965334300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000000004eed4be1acf5e047f86fed1d359d4767bb2569b42c9aac71e91d27efc56b881500000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000006e0e2da413b4f6c9df80000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000014b442e5d9bdb937001bbf34817e9317b49156d6320000000000000000000000000000000000000000000000000000000000000000000000000000000000000014b442e5d9bdb937001bbf34817e9317b49156d6320000000000000000000000000000000000000000000000000000000000000000000000000000000000000000";
    case "scroll":
      // https://scrollscan.com/tx/0x622e1de9ce9f8617717430dc08e3202a39cfeb3a45cde4870b9b53632dacf9c8
      return "0x1a98b2e0ff81bf83ef946e048e90d2bcbeb88f0c3ddb05e71ce94120a3061a20dbb7f29800000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001600000000000000000000000000000000000000000000000000000000000000d80000000000000000000000000000000000000000000000000000000000ee9991400000000000000000000000000000000000000000000000000000000000000046261736500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a307863653136463639333735353230616230313337376365374238386635424138433438463844363636000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000004000000000000000000000000021ce0dcc5d86e2f23d945c3430bfcf5f71ec7341000000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000036000000000000000000000000000000000000000000000000000000000000005a0000000000000000000000000000000000000000000000000000000000000072000000000000000000000000000000000000000000000000000000000000009600000000000000000000000000000000000000000000000000000000000000ac000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f4052150000000000000000000000000000000000000000000000000000000000000001000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f405215000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000044095ea7b300000000000000000000000033d91116e0370970444b0281ab117e161febfcdd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f4052150000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000033d91116e0370970444b0281ab117e161febfcdd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000104414bf389000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f40521500000000000000000000000006efdbff2a14a7c8e15944d1f4a48f9f95f663a40000000000000000000000000000000000000000000000000000000000000064000000000000000000000000ea749fd6ba492dbc14c24fe8a3d08769229b896c0000000000000000000000000000000000000000000000000000018e595e9884000000000000000000000000000000000000000000000000000000000ee7148a000000000000000000000000000000000000000000000000000000000ee63ef50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f4052150000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000100000000000000000000000006efdbff2a14a7c8e15944d1f4a48f9f95f663a4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000044095ea7b300000000000000000000000033d91116e0370970444b0281ab117e161febfcdd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000006efdbff2a14a7c8e15944d1f4a48f9f95f663a40000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000033d91116e0370970444b0281ab117e161febfcdd000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001e00000000000000000000000000000000000000000000000000000000000000104414bf38900000000000000000000000006efdbff2a14a7c8e15944d1f4a48f9f95f663a400000000000000000000000053000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000bb8000000000000000000000000ea749fd6ba492dbc14c24fe8a3d08769229b896c0000000000000000000000000000000000000000000000000000018e595e9884000000000000000000000000000000000000000000000000000000000ef5906e00000000000000000000000000000000000000000000000001122e1ff727f679000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000006efdbff2a14a7c8e15944d1f4a48f9f95f663a4000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000010000000000000000000000005300000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000242e1a7d4d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000053000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000000000000000021ce0dcc5d86e2f23d945c3430bfcf5f71ec7341000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000761786c5553444300000000000000000000000000000000000000000000000000";
    case "arbitrum":
      // https://arbiscan.io/tx/0x8b173ad2743f71fe11c4f8286f082eaca4e87f0a0c1ab5475ddfeea06a76a5b6
      return "0x1a98b2e0fb313e7ca5ed1f3291aa4ff345e12801b521c060644c8f57f678b14ca03b00b600000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000006e0000000000000000000000000000000000000000000000000000000000067aaf2000000000000000000000000000000000000000000000000000000000000000646616e746f6d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002a3078636531364636393337353532306162303133373763653742383866354241384334384638443636360000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005600000000000000000000000000000000000000000000000000000000000000040000000000000000000000000e77428ce19ad1ad1c7f85fe86119793520b48e8100000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000002e000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f4052150000000000000000000000000000000000000000000000000000000000000001000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f405215000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000000000000000044095ea7b300000000000000000000000068b3465833fb72a70ecdf485e0e4c7bd8665fc450000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f4052150000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000100000000000000000000000068b3465833fb72a70ecdf485e0e4c7bd8665fc45000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000001c000000000000000000000000000000000000000000000000000000000000000e404e45aaf000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f405215000000000000000000000000ff970a61a04b1ca14834a43f5de4533ebddb5cc80000000000000000000000000000000000000000000000000000000000000064000000000000000000000000e77428ce19ad1ad1c7f85fe86119793520b48e81000000000000000000000000000000000000000000000000000000000067aaf200000000000000000000000000000000000000000000000000000000006695700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000eb466342c4d449bc9f53a865d5cb90586f4052150000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000761786c5553444300000000000000000000000000000000000000000000000000";
    default:
      return undefined;
  }
}

const gasPrice = {
  optimism: "7833895",
  mantle: "20000000",
  blast: "970255",
  fraxtal: "1000254",
  base: "74400000",
  scroll: "510000000",
  arbitrum: "10000000",
} as any;

const actualExecutionFeesByDestChain = {
  optimism: "2540000000000", // https://axelarscan.io/gmp/0xfd6ce98b4786d94efa10d6dd656cff410fa0333e13b7d4d0065fbfe5c7d94082:470
  mantle: "3308330944347", // Copy Transaction Fee (USD amount) from https://explorer.mantle.xyz/tx/0xd4f6627648dd7d4ab23537ae9020915c5ee870c8260938f13d9685b46a16a237, then paste it on the ETH converter https://www.coingecko.com/en/coins/ethereum to get ETH amount
  blast: "470455445300145", // https://blastscan.io/tx/0xd15a62a0231f3907cf9406b61f1ca134e931d9b7244813fca476e5664cfb42df
  fraxtal: "32684729525647", // https://fraxscan.com/tx/0xc8dbb8fecc8355422be4c6706e1a280cf8e98f1e1044d554ee4abac2e60f1668
  base: "8589990324241", // https://basescan.org/tx/0xad7f09d9fc648eef78fa08107b576e948ccf1f78d6149aff1b8273e535f1fbe8
  scroll: "877320885825921", // https://scrollscan.com/tx/0x622e1de9ce9f8617717430dc08e3202a39cfeb3a45cde4870b9b53632dacf9c8
  arbitrum: "3829100000000", // https://arbiscan.io/tx/0x8b173ad2743f71fe11c4f8286f082eaca4e87f0a0c1ab5475ddfeea06a76a5b6
} as any;

function min(a: BigNumber, b: BigNumber) {
  return a.lt(b) ? a : b;
}

function max(a: BigNumber, b: BigNumber) {
  return a.gt(b) ? a : b;
}

function calculateDiffPercentage(actual: BigNumber, expected: BigNumber) {
  const diff = max(actual, expected).sub(min(actual, expected)).toNumber();
  const percent = (diff / actual.toNumber()) * 100;

  return percent;
}

async function apiEstimate(srcChain: string, destChain: string) {
  const gasLimit = getGasLimit(destChain);

  const result: any = await fetch(
    "https://api.axelarscan.io/gmp/estimateGasFee",
    {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        sourceChain: srcChain,
        destinationChain: destChain,
        gasLimit: gasLimit,
        executeData: getExecuteData(destChain),
        showDetailedFees: true,
        gasMultiplier: GAS_MULTIPLIER,
      }),
    }
  ).then((res) => res.json());

  return {
    baseFee: result.baseFee,
    totalFee: result.executionFee,
  };
}

async function sdkEstimate(
  env: Environment,
  srcChain: string,
  destChain: string
) {
  const client = new AxelarQueryAPI({
    environment: env,
  });
  const gasLimit = getGasLimit(destChain);

  const fee = await client.estimateGasFee(
    srcChain,
    destChain,
    gasLimit,
    GAS_MULTIPLIER,
    undefined,
    undefined,
    getExecuteData(destChain),
    {
      showDetailedFees: true,
      destinationContractAddress: "",
      sourceContractAddress: "",
      tokenSymbol: "",
    }
  );

  const feeDetails = fee as AxelarQueryAPIFeeResponse;

  return {
    baseFee: feeDetails.baseFee,
    executionFee: feeDetails.executionFee,
    l1ExecutionFee: feeDetails.l1ExecutionFee,
    gasPrice:
      feeDetails.apiResponse.result.destination_native_token.gas_price_in_units
        .value,
  };
}

export default async function test() {
  const srcChain = "ethereum";
  const destChains = [
    "mantle",
    "optimism",
    "base",
    "scroll",
    "arbitrum",
    "fraxtal",
    "blast",
  ];

  const pendingSdkFees = destChains.map((destChain) =>
    sdkEstimate(Environment.MAINNET, srcChain, destChain)
  );
  const pendingApiFees = destChains.map((destChain) =>
    apiEstimate(srcChain, destChain)
  );

  const sdkFees = await Promise.all(pendingSdkFees);
  const apiFees = await Promise.all(pendingApiFees);

  for (let i = 0; i < sdkFees.length; i++) {
    console.log(
      "\n================================================================="
    );
    console.log(
      `[SDK] baseFee for ${srcChain} to ${
        destChains[i]
      }: ${ethers.utils.formatEther(sdkFees[i].baseFee)} ETH`
    );
    console.log(
      `[API] baseFee for ${srcChain} to ${
        destChains[i]
      }: ${ethers.utils.formatEther(apiFees[i].baseFee)} ETH`
    );
    // console.log(
    //   `executionFee for ${srcChain} to ${
    //     destChains[i]
    //   }: ${ethers.utils.formatEther(sdkFees[i].executionFee)} ETH`
    // );
    // console.log(
    //   `l1ExecutionFee for ${srcChain} to ${
    //     destChains[i]
    //   }: ${ethers.utils.formatEther(sdkFees[i].l1ExecutionFee)} ETH`
    // );

    const totalExecutionFee = ethers.BigNumber.from(
      sdkFees[i].executionFee
    ).add(sdkFees[i].l1ExecutionFee);
    console.log(
      `[SDK] totalExecutionFee for ${srcChain} to ${
        destChains[i]
      }: ${ethers.utils.formatEther(totalExecutionFee)} ETH`
    );
    console.log(
      `[API] totalExecutionFee for ${srcChain} to ${
        destChains[i]
      }: ${ethers.utils.formatEther(apiFees[i].totalFee)} ETH`
    );
    if (actualExecutionFeesByDestChain[destChains[i]]) {
      const actualExecutionFee = ethers.BigNumber.from(
        actualExecutionFeesByDestChain[destChains[i]]
      );

      console.log(
        `[Actual] totalExecutionFee for ${srcChain} to ${
          destChains[i]
        }: ${ethers.utils.formatEther(actualExecutionFee)} ETH`
      );

      console.log(
        `Execution Fee SDK vs Actual Cost for ${
          destChains[i]
        }: ${calculateDiffPercentage(
          actualExecutionFee,
          totalExecutionFee
        )} % (${
          actualExecutionFee.lt(totalExecutionFee)
            ? "SDK is more expensive"
            : "SDK is cheaper"
        })`
      );

      const executedGasPrice = ethers.utils.formatUnits(
        gasPrice[destChains[i]],
        "gwei"
      );
      const currentGasPrice = ethers.utils.formatUnits(
        sdkFees[i].gasPrice,
        "gwei"
      );

      console.log(
        `\nNote: Current Gas Price: ${currentGasPrice} gwei vs Executed Gas Price: ${executedGasPrice} gwei. ${
          currentGasPrice < executedGasPrice
            ? "Gas price is currently cheaper"
            : "Gas price is currently more expensive"
        } by ${calculateDiffPercentage(
          ethers.BigNumber.from(gasPrice[destChains[i]]),
          ethers.BigNumber.from(sdkFees[i].gasPrice)
        )} %`
      );
    }
  }
}
